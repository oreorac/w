create or replace package body schema_project_pkg_75
As
procedure book_validations(errbuf out varchar2,retcode out number) as
cursor c1 is select * from book_schema_m2_75_temp;
v_AUTHOR_ID book_schema_m2_75_temp.AUTHOR_ID%type;
v_ISBN_NUMBER book_schema_m2_75_temp.ISBN_NUMBER%type;
v_PUBLISHING_DATE book_schema_m2_75_temp.PUBLISHING_DATE%type;
v_BOOK_TYPE book_schema_m2_75_temp.BOOK_TYPE%type;
begin
for v_c1 in c1
loop
if(validate_AUTHOR_ID(v_c1.AUTHOR_ID)) then
 if(validate_ISBN_NUMBER(v_c1.ISBN_NUMBEr)) then
  if(v_c1.PAGES>0 AND v_c1.COST>0) then
   v_PUBLISHING_DATE:=validate_PUBLISHING_DATE(v_c1.publishing_date);
   if(validate_BOOK_TYPE(v_c1.BOOK_TYPE)) then
    insert into book_schema_m2_75 values
     (seq_75.nextval,v_c1.AUTHOR_ID,v_c1.BOOK_NAME,
     v_c1.ISBN_NUMBER,v_c1.PAGES,v_c1.COST,
     v_PUBLISHING_DATE,v_c1.BOOK_TYPE);
   End if;
  end if;
 end if;
end if;
end loop;
end book_validations;
Function validate_author_id(AUTH_ID IN Number) return boolean as
v_count number;
begin
 select count(*) into v_count from author_schema_m1_75 where author_id=AUTH_ID;
 if(v_count>0) then
  return true;
 else
  return false;
 end if;
end validate_author_id;
Function validate_ISBN_NUMBER(ISBN_NO in number) return boolean as
v_count number;
begin
 select count(*) into v_count from book_schema_m2_75 where ISBN_NUMBER=ISBN_NO;
 if(v_count=0) then
  return true;
 else
  return false;
 end if;
end validate_ISBN_NUMBER;
Function validate_PUBLISHING_DATE(publishing_date in date) return date as
v_pub date;
begin
if(publishing_date > sysdate) then
 v_pub:=sysdate;
else
 v_pub:=publishing_date;
end if;
return v_pub;
end validate_PUBLISHING_DATE;
Function validate_BOOK_TYPE(BOOK_TYPE in varchar2) return boolean as
begin
 if(BOOK_TYPE='Fiction' OR BOOK_TYPE='Non-Fiction' OR
  BOOK_TYPE='Business' OR BOOK_TYPE='Audio') then
  return true;
 else
  return false;
 end if;
end validate_BOOK_TYPE;
end schema_project_pkg_75;
/
